name: Pages Diagnostics
permissions:
  contents: read

on:
  workflow_dispatch: {}

jobs:
  diag:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout gh-pages
        uses: actions/checkout@v4
        with:
          ref: gh-pages
          fetch-depth: 1

      - name: List top level files
        run: |
          ls -la | sed -n '1,120p'

      - name: Show CNAME and index.html head
        run: |
          if [ -f CNAME ]; then echo '--- CNAME ---'; cat CNAME; else echo 'CNAME missing'; fi
          echo '--- index.html head ---'
          if [ -f index.html ]; then head -n 80 index.html; else echo 'index.html missing'; fi

      - name: Repo Pages settings
        uses: actions/github-script@v7
        with:
          script: |
            const {owner, repo} = context.repo;
            const res = await github.rest.repos.getPages({ owner, repo });
            core.info(JSON.stringify(res.data, null, 2));

      - name: Curl live site
        run: |
          set +e
          echo '--- HTTPS HEAD ---'
          curl -I --max-time 20 -L https://paninifs.org || true
          echo '--- HTTPS body sample ---'
          curl -s --max-time 20 -L https://paninifs.org | head -n 80 || true
          echo '--- Research whats-new ---'
          curl -I --max-time 20 -L https://paninifs.org/research/whats-new.html || true
          echo '--- Research feed.xml ---'
          curl -I --max-time 20 -L https://paninifs.org/research/feed.xml || true